<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trading Platform - S√†n Giao D·ªãch Chuy√™n Nghi·ªáp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
  <!-- Header -->
  <nav class="navbar navbar-dark bg-dark shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <i class="fas fa-chart-line"></i> CryptoTrade Pro
      </a>
      <div class="d-flex align-items-center gap-3">
        <div class="d-flex align-items-center gap-2">
          <i class="fas fa-user-circle" style="color: #00ff41; font-size: 20px;"></i>
          <span class="text-light" id="userEmail" style="color: #00ff41 !important; text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);">--</span>
        </div>
        <div class="d-flex align-items-center gap-2">
          <i class="fas fa-wallet" style="color: #ffc107; font-size: 18px;"></i>
          <span class="text-light small" id="walletAddress" style="color: #ffc107 !important; font-family: monospace;">
            --
          </span>
        </div>
        <button class="btn btn-sm btn-outline-light" onclick="connectWallet()">
          <i class="fas fa-wallet"></i> <span id="walletStatus">K·∫øt n·ªëi v√≠</span>
        </button>
        <button class="btn btn-sm btn-danger" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
        </button>
      </div>
    </div>
  </nav>

  <div class="trading-container">
    <!-- Sidebar -->
    <aside class="sidebar bg-dark text-light">
      <div class="sidebar-header p-3 border-bottom border-secondary">
        <h6 class="mb-0"><i class="fas fa-coins"></i> Th·ªã tr∆∞·ªùng</h6>
      </div>
      <div class="market-list">
        <div class="market-item active" data-pair="ETH/USDT" data-coin="ethereum">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>ETH/USDT</strong>
              <small class="d-block text-muted">Ethereum</small>
            </div>
            <div class="text-end">
              <div class="price-up">$2,345.67</div>
              <small class="text-success">+2.34%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="BTC/USDT" data-coin="bitcoin">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>BTC/USDT</strong>
              <small class="d-block text-muted">Bitcoin</small>
            </div>
            <div class="text-end">
              <div class="price-up">$43,210.50</div>
              <small class="text-success">+1.52%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="BNB/USDT" data-coin="binancecoin">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>BNB/USDT</strong>
              <small class="d-block text-muted">Binance Coin</small>
            </div>
            <div class="text-end">
              <div class="price-down">$312.45</div>
              <small class="text-danger">-0.85%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="SOL/USDT" data-coin="solana">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>SOL/USDT</strong>
              <small class="d-block text-muted">Solana</small>
            </div>
            <div class="text-end">
              <div class="price-up">$98.45</div>
              <small class="text-success">+3.12%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="XRP/USDT" data-coin="ripple">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>XRP/USDT</strong>
              <small class="d-block text-muted">Ripple</small>
            </div>
            <div class="text-end">
              <div class="price-up">$0.5234</div>
              <small class="text-success">+1.87%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="ADA/USDT" data-coin="cardano">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>ADA/USDT</strong>
              <small class="d-block text-muted">Cardano</small>
            </div>
            <div class="text-end">
              <div class="price-down">$0.3876</div>
              <small class="text-danger">-2.34%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="DOGE/USDT" data-coin="dogecoin">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>DOGE/USDT</strong>
              <small class="d-block text-muted">Dogecoin</small>
            </div>
            <div class="text-end">
              <div class="price-up">$0.0823</div>
              <small class="text-success">+5.67%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="MATIC/USDT" data-coin="matic-network">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>MATIC/USDT</strong>
              <small class="d-block text-muted">Polygon</small>
            </div>
            <div class="text-end">
              <div class="price-up">$0.8234</div>
              <small class="text-success">+2.45%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="DOT/USDT" data-coin="polkadot">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>DOT/USDT</strong>
              <small class="d-block text-muted">Polkadot</small>
            </div>
            <div class="text-end">
              <div class="price-down">$5.67</div>
              <small class="text-danger">-1.23%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="AVAX/USDT" data-coin="avalanche-2">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>AVAX/USDT</strong>
              <small class="d-block text-muted">Avalanche</small>
            </div>
            <div class="text-end">
              <div class="price-up">$34.56</div>
              <small class="text-success">+4.12%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="LINK/USDT" data-coin="chainlink">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>LINK/USDT</strong>
              <small class="d-block text-muted">Chainlink</small>
            </div>
            <div class="text-end">
              <div class="price-up">$14.23</div>
              <small class="text-success">+1.98%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="UNI/USDT" data-coin="uniswap">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>UNI/USDT</strong>
              <small class="d-block text-muted">Uniswap</small>
            </div>
            <div class="text-end">
              <div class="price-down">$6.78</div>
              <small class="text-danger">-0.56%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="LTC/USDT" data-coin="litecoin">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>LTC/USDT</strong>
              <small class="d-block text-muted">Litecoin</small>
            </div>
            <div class="text-end">
              <div class="price-up">$72.34</div>
              <small class="text-success">+2.11%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="ATOM/USDT" data-coin="cosmos">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>ATOM/USDT</strong>
              <small class="d-block text-muted">Cosmos</small>
            </div>
            <div class="text-end">
              <div class="price-up">$9.87</div>
              <small class="text-success">+3.45%</small>
            </div>
          </div>
        </div>
        <div class="market-item" data-pair="SHIB/USDT" data-coin="shiba-inu">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>SHIB/USDT</strong>
              <small class="d-block text-muted">Shiba Inu</small>
            </div>
            <div class="text-end">
              <div class="price-down">$0.000009</div>
              <small class="text-danger">-1.87%</small>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Stats -->
      <div class="stats-bar bg-white border-bottom">
        <div class="container-fluid py-2">
          <div class="row g-3">
            <div class="col-auto">
              <div class="stat-item">
                <small class="text-muted">Gi√° hi·ªán t·∫°i</small>
                <div class="h5 mb-0" id="currentPrice">$2,345.67</div>
              </div>
            </div>
            <div class="col-auto">
              <div class="stat-item">
                <small class="text-muted">24h Thay ƒë·ªïi</small>
                <div class="h5 mb-0 text-success">+2.34%</div>
              </div>
            </div>
            <div class="col-auto">
              <div class="stat-item">
                <small class="text-muted">24h Cao</small>
                <div class="h5 mb-0">$2,456.89</div>
              </div>
            </div>
            <div class="col-auto">
              <div class="stat-item">
                <small class="text-muted">24h Th·∫•p</small>
                <div class="h5 mb-0">$2,298.34</div>
              </div>
            </div>
            <div class="col-auto">
              <div class="stat-item">
                <small class="text-muted">Kh·ªëi l∆∞·ª£ng 24h</small>
                <div class="h5 mb-0">124,567 ETH</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart Area -->
      <div class="chart-section bg-white">
        <div class="chart-header d-flex justify-content-between align-items-center p-3 border-bottom">
          <div>
            <h5 class="mb-0">ETH/USDT</h5>
          </div>
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-outline-secondary">1H</button>
            <button type="button" class="btn btn-sm btn-outline-secondary active">4H</button>
            <button type="button" class="btn btn-sm btn-outline-secondary">1D</button>
            <button type="button" class="btn btn-sm btn-outline-secondary">1W</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="priceChart"></canvas>
        </div>
      </div>

      <!-- Trading & Order Book -->
      <div class="trading-section">
        <div class="row g-0">
          <!-- Order Book -->
          <div class="col-md-4 border-end">
            <div class="order-book bg-white h-100">
              <div class="p-3 border-bottom">
                <h6 class="mb-0"><i class="fas fa-book"></i> S·ªï l·ªánh</h6>
              </div>
              <div class="order-book-content">
                <table class="table table-sm mb-0">
                  <thead>
                    <tr>
                      <th>Gi√° (USDT)</th>
                      <th class="text-end">S·ªë l∆∞·ª£ng (ETH)</th>
                      <th class="text-end">T·ªïng</th>
                    </tr>
                  </thead>
                  <tbody id="sellOrders">
                    <tr class="sell-order">
                      <td class="text-danger">2,347.89</td>
                      <td class="text-end">0.5234</td>
                      <td class="text-end">1,228.92</td>
                    </tr>
                    <tr class="sell-order">
                      <td class="text-danger">2,347.12</td>
                      <td class="text-end">1.2341</td>
                      <td class="text-end">2,896.45</td>
                    </tr>
                    <tr class="sell-order">
                      <td class="text-danger">2,346.45</td>
                      <td class="text-end">0.8923</td>
                      <td class="text-end">2,094.12</td>
                    </tr>
                  </tbody>
                </table>
                <div class="current-price-row p-2 bg-light text-center">
                  <strong class="text-success">2,345.67</strong>
                  <small class="ms-2">‚âà $2,345.67</small>
                </div>
                <table class="table table-sm mb-0">
                  <tbody id="buyOrders">
                    <tr class="buy-order">
                      <td class="text-success">2,345.23</td>
                      <td class="text-end">0.7456</td>
                      <td class="text-end">1,748.92</td>
                    </tr>
                    <tr class="buy-order">
                      <td class="text-success">2,344.78</td>
                      <td class="text-end">1.5678</td>
                      <td class="text-end">3,674.56</td>
                    </tr>
                    <tr class="buy-order">
                      <td class="text-success">2,344.12</td>
                      <td class="text-end">0.4321</td>
                      <td class="text-end">1,012.89</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Trading Form -->
          <div class="col-md-4 border-end">
            <div class="trading-form bg-white h-100">
              <div class="p-3">
                <ul class="nav nav-tabs mb-3" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#buy-tab">Mua</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#sell-tab">B√°n</button>
                  </li>
                </ul>

                <div class="tab-content">
                  <!-- Buy Tab -->
                  <div class="tab-pane fade show active" id="buy-tab">
                    <div class="mb-3">
                      <label class="form-label small">S·ªë d∆∞ kh·∫£ d·ª•ng</label>
                      <div class="text-end">
                        <strong id="balance">0.0000</strong> <span class="text-muted">ETH</span>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">Gi√°</label>
                      <div class="input-group">
                        <input type="number" class="form-control" id="buyPrice" placeholder="0.00" value="2345.67">
                        <span class="input-group-text">USDT</span>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">S·ªë l∆∞·ª£ng</label>
                      <div class="input-group">
                        <input type="number" class="form-control" id="buyAmount" placeholder="0.00">
                        <span class="input-group-text">ETH</span>
                      </div>
                    </div>
                    <div class="mb-3">
                      <input type="range" class="form-range" min="0" max="100" step="25" id="buyPercentage">
                      <div class="d-flex justify-content-between small text-muted">
                        <span>0%</span>
                        <span>25%</span>
                        <span>50%</span>
                        <span>75%</span>
                        <span>100%</span>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">T·ªïng</label>
                      <div class="input-group">
                        <input type="number" class="form-control" id="buyTotal" placeholder="0.00" readonly>
                        <span class="input-group-text">USDT</span>
                      </div>
                    </div>
                    <button class="btn btn-success w-100" onclick="depositETH()">
                      <i class="fas fa-arrow-up"></i> Mua ETH
                    </button>
                  </div>

                  <!-- Sell Tab -->
                  <div class="tab-pane fade" id="sell-tab">
                    <div class="mb-3">
                      <label class="form-label small">S·ªë d∆∞ kh·∫£ d·ª•ng</label>
                      <div class="text-end">
                        <strong id="balanceSell">0.0000</strong> <span class="text-muted">ETH</span>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">Gi√°</label>
                      <div class="input-group">
                        <input type="number" class="form-control" id="sellPrice" placeholder="0.00" value="2345.67">
                        <span class="input-group-text">USDT</span>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">S·ªë l∆∞·ª£ng</label>
                      <div class="input-group">
                        <input type="number" class="form-control" id="sellAmount" placeholder="0.00">
                        <span class="input-group-text">ETH</span>
                      </div>
                    </div>
                    <div class="mb-3">
                      <input type="range" class="form-range" min="0" max="100" step="25" id="sellPercentage">
                      <div class="d-flex justify-content-between small text-muted">
                        <span>0%</span>
                        <span>25%</span>
                        <span>50%</span>
                        <span>75%</span>
                        <span>100%</span>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label small">T·ªïng</label>
                      <div class="input-group">
                        <input type="number" class="form-control" id="sellTotal" placeholder="0.00" readonly>
                        <span class="input-group-text">USDT</span>
                      </div>
                    </div>
                    <button class="btn btn-danger w-100" onclick="withdrawETH()">
                      <i class="fas fa-arrow-down"></i> B√°n ETH
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Trades -->
          <div class="col-md-4">
            <div class="recent-trades bg-white h-100">
              <div class="p-3 border-bottom">
                <h6 class="mb-0"><i class="fas fa-history"></i> Giao d·ªãch g·∫ßn ƒë√¢y</h6>
              </div>
              <div class="trades-list">
                <table class="table table-sm table-hover mb-0">
                  <thead>
                    <tr>
                      <th>Gi√° (USDT)</th>
                      <th class="text-end">S·ªë l∆∞·ª£ng (ETH)</th>
                      <th class="text-end">Th·ªùi gian</th>
                    </tr>
                  </thead>
                  <tbody id="recentTrades">
                    <tr>
                      <td class="text-success">2,345.67</td>
                      <td class="text-end">0.1234</td>
                      <td class="text-end text-muted">14:32:15</td>
                    </tr>
                    <tr>
                      <td class="text-danger">2,345.12</td>
                      <td class="text-end">0.5678</td>
                      <td class="text-end text-muted">14:31:58</td>
                    </tr>
                    <tr>
                      <td class="text-success">2,346.89</td>
                      <td class="text-end">0.8923</td>
                      <td class="text-end text-muted">14:31:42</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Order History -->
      <div class="order-history bg-white mt-3">
        <div class="p-3 border-bottom">
          <ul class="nav nav-pills">
            <li class="nav-item">
              <a class="nav-link active" href="#openOrders" data-bs-toggle="tab">L·ªánh m·ªü</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#orderHistory" data-bs-toggle="tab">L·ªãch s·ª≠ l·ªánh</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#tradeHistory" data-bs-toggle="tab">L·ªãch s·ª≠ giao d·ªãch</a>
            </li>
          </ul>
        </div>
        <div class="tab-content p-3">
          <div class="tab-pane fade show active" id="openOrders">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Th·ªùi gian</th>
                  <th>C·∫∑p</th>
                  <th>Lo·∫°i</th>
                  <th>B√™n</th>
                  <th>Gi√°</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>ƒê√£ kh·ªõp</th>
                  <th>T·ªïng</th>
                  <th>H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="9" class="text-center text-muted py-4">Kh√¥ng c√≥ l·ªánh m·ªü</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="tab-pane fade" id="orderHistory">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Th·ªùi gian</th>
                  <th>C·∫∑p</th>
                  <th>Lo·∫°i</th>
                  <th>B√™n</th>
                  <th>Gi√°</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>T·ªïng</th>
                  <th>Tr·∫°ng th√°i</th>
                </tr>
              </thead>
              <tbody id="history">
              </tbody>
            </table>
          </div>
          <div class="tab-pane fade" id="tradeHistory">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Th·ªùi gian</th>
                  <th>C·∫∑p</th>
                  <th>B√™n</th>
                  <th>Gi√°</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>Ph√≠</th>
                  <th>T·ªïng</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="7" class="text-center text-muted py-4">Ch∆∞a c√≥ giao d·ªãch</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="app.js"></script>
  
  <script>
    // Authentication check with MD5 validation
    if (localStorage.getItem("loggedIn") !== "true") {
      window.location.href = "login.html";
    }
    
    // Verify password hash
    const passwordHash = localStorage.getItem("passwordHash");
    const validHash = "53d51dc5720d345c3c15c1cd4997814f"; // MD5 c·ªßa "@@@@@@@@"
    
    if (!passwordHash || passwordHash !== validHash) {
      localStorage.clear();
      window.location.href = "login.html";
    }
    
    // Display username
    const username = localStorage.getItem("username");
    const userEmail = localStorage.getItem("userEmail");
    
    if (username) {
      document.getElementById("userEmail").textContent = username;
    } else if (userEmail) {
      document.getElementById("userEmail").textContent = userEmail;
    }

    // Display wallet address
    const savedWalletAddress = localStorage.getItem("walletAddress");
    if (savedWalletAddress) {
      const shortAddress = savedWalletAddress.substring(0, 6) + '...' + savedWalletAddress.substring(38);
      document.getElementById("walletAddress").textContent = shortAddress;
      document.getElementById("walletAddress").title = savedWalletAddress; // Full address on hover
      document.getElementById("walletStatus").textContent = "ƒê√£ k·∫øt n·ªëi";
    } else {
      // Set default wallet address
      const defaultWallet = "0x0c85940906a6c957476ce75752dbbbdf3b66fbc9";
      localStorage.setItem("walletAddress", defaultWallet);
      const shortAddress = defaultWallet.substring(0, 6) + '...' + defaultWallet.substring(38);
      document.getElementById("walletAddress").textContent = shortAddress;
      document.getElementById("walletAddress").title = defaultWallet;
    }

    // Global Web3 instance
    let web3;
    let userAccount = null;

    // Update connectWallet function with real MetaMask integration
    window.connectWallet = async function() {
      if (typeof window.ethereum !== 'undefined') {
        try {
          // Request account access
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
          userAccount = accounts[0];
          
          // Initialize Web3
          web3 = new Web3(window.ethereum);
          
          // Save to localStorage
          localStorage.setItem("walletAddress", userAccount);
          
          // Display shortened address
          const shortAddress = userAccount.substring(0, 6) + '...' + userAccount.substring(38);
          document.getElementById("walletAddress").textContent = shortAddress;
          document.getElementById("walletAddress").title = userAccount;
          document.getElementById("walletStatus").textContent = "ƒê√£ k·∫øt n·ªëi";
          
          // Get and display balance
          await updateBalance();
          
          // Listen for account changes
          ethereum.on('accountsChanged', async function (accounts) {
            if (accounts.length === 0) {
              console.log('Please connect to MetaMask.');
              document.getElementById("walletStatus").textContent = "K·∫øt n·ªëi v√≠";
            } else if (accounts[0] !== userAccount) {
              userAccount = accounts[0];
              localStorage.setItem("walletAddress", userAccount);
              const shortAddress = userAccount.substring(0, 6) + '...' + userAccount.substring(38);
              document.getElementById("walletAddress").textContent = shortAddress;
              document.getElementById("walletAddress").title = userAccount;
              await updateBalance();
            }
          });
          
          // Listen for chain changes
          ethereum.on('chainChanged', (_chainId) => window.location.reload());
          
          alert(`‚úÖ ƒê√£ k·∫øt n·ªëi v·ªõi MetaMask\n\nƒê·ªãa ch·ªâ: ${userAccount}\n\nVui l√≤ng ki·ªÉm tra s·ªë d∆∞ ETH c·ªßa b·∫°n.`);
          
        } catch (error) {
          console.error('Error connecting wallet:', error);
          if (error.code === 4001) {
            alert('‚ùå B·∫°n ƒë√£ t·ª´ ch·ªëi k·∫øt n·ªëi v·ªõi MetaMask');
          } else {
            alert('‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi v·ªõi MetaMask\n\nL·ªói: ' + error.message);
          }
        }
      } else {
        alert('‚ö†Ô∏è MetaMask ch∆∞a ƒë∆∞·ª£c c√†i ƒë·∫∑t!\n\nVui l√≤ng c√†i ƒë·∫∑t MetaMask extension:\nhttps://metamask.io/download/');
        window.open('https://metamask.io/download/', '_blank');
      }
    };

    // Update balance from blockchain
    async function updateBalance() {
      if (!web3 || !userAccount) {
        console.log('Web3 or account not initialized');
        return;
      }
      
      try {
        // Get balance in Wei
        const balanceWei = await web3.eth.getBalance(userAccount);
        
        // Convert to ETH
        const balanceEth = web3.utils.fromWei(balanceWei, 'ether');
        
        // Update UI
        const formattedBalance = parseFloat(balanceEth).toFixed(8);
        document.getElementById('balance').textContent = formattedBalance;
        document.getElementById('balanceSell').textContent = formattedBalance;
        
        // Save to localStorage
        localStorage.setItem('ethBalance', formattedBalance);
        
        console.log(`‚úÖ Balance updated: ${formattedBalance} ETH`);
        
        // Get network info
        const networkId = await web3.eth.net.getId();
        const networkName = getNetworkName(networkId);
        console.log(`üì° Network: ${networkName} (ID: ${networkId})`);
        
      } catch (error) {
        console.error('Error fetching balance:', error);
        alert('‚ùå Kh√¥ng th·ªÉ l·∫•y s·ªë d∆∞ t·ª´ blockchain\n\nL·ªói: ' + error.message);
      }
    }

    // Get network name
    function getNetworkName(networkId) {
      const networks = {
        1: 'Ethereum Mainnet',
        3: 'Ropsten Testnet',
        4: 'Rinkeby Testnet',
        5: 'Goerli Testnet',
        11155111: 'Sepolia Testnet',
        56: 'BSC Mainnet',
        97: 'BSC Testnet',
        137: 'Polygon Mainnet',
        80001: 'Mumbai Testnet'
      };
      return networks[networkId] || `Unknown Network (${networkId})`;
    }

    // Auto-connect if previously connected
    async function autoConnectWallet() {
      const savedWallet = localStorage.getItem("walletAddress");
      if (savedWallet && typeof window.ethereum !== 'undefined') {
        try {
          const accounts = await ethereum.request({ method: 'eth_accounts' });
          if (accounts.length > 0 && accounts[0].toLowerCase() === savedWallet.toLowerCase()) {
            userAccount = accounts[0];
            web3 = new Web3(window.ethereum);
            
            const shortAddress = userAccount.substring(0, 6) + '...' + userAccount.substring(38);
            document.getElementById("walletAddress").textContent = shortAddress;
            document.getElementById("walletAddress").title = userAccount;
            document.getElementById("walletStatus").textContent = "ƒê√£ k·∫øt n·ªëi";
            
            await updateBalance();
            console.log('‚úÖ Auto-connected to MetaMask');
          }
        } catch (error) {
          console.error('Auto-connect failed:', error);
        }
      } else if (savedWallet) {
        // Show saved address but not connected
        const shortAddress = savedWallet.substring(0, 6) + '...' + savedWallet.substring(38);
        document.getElementById("walletAddress").textContent = shortAddress;
        document.getElementById("walletAddress").title = savedWallet;
      }
    }

    // Call auto-connect on page load
    autoConnectWallet();

    // Update depositETH function to use real MetaMask
    window.depositETH = async function() {
      const amount = document.getElementById('buyAmount').value;
      
      if (!amount || parseFloat(amount) <= 0) {
        alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng ETH h·ª£p l·ªá');
        return;
      }
      
      if (!web3 || !userAccount) {
        alert('‚ö†Ô∏è Vui l√≤ng k·∫øt n·ªëi MetaMask tr∆∞·ªõc!');
        await connectWallet();
        return;
      }
      
      const price = parseFloat(document.getElementById('buyPrice').value) || 0;
      const total = (price * parseFloat(amount)).toFixed(2);
      
      if (confirm(`X√°c nh·∫≠n mua ${amount} ETH v·ªõi gi√° $${price.toLocaleString()}?\n\nT·ªïng: $${parseFloat(total).toLocaleString()} USDT`)) {
        try {
          // Save transaction to history
          const transaction = {
            type: 'deposit',
            amount: amount,
            price: price,
            total: total,
            pair: document.querySelector('.market-item.active').dataset.pair,
            timestamp: Date.now(),
            txHash: 'Simulated-' + Date.now()
          };
          
          const history = JSON.parse(localStorage.getItem('transactionHistory') || '[]');
          history.push(transaction);
          localStorage.setItem('transactionHistory', JSON.stringify(history));
          
          // Reload histories
          loadOrderHistory();
          loadTradeHistory();
          
          // Update balance
          await updateBalance();
          
          alert(`‚úÖ ƒê√£ mua th√†nh c√¥ng ${amount} ETH!\n\nGiao d·ªãch ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o l·ªãch s·ª≠.`);
          
          // Clear inputs
          document.getElementById('buyAmount').value = '';
          document.getElementById('buyTotal').value = '';
          
        } catch (error) {
          console.error('Transaction error:', error);
          alert('‚ùå Giao d·ªãch th·∫•t b·∫°i\n\nL·ªói: ' + error.message);
        }
      }
    };

    // Update withdrawETH function
    window.withdrawETH = async function() {
      const amount = document.getElementById('sellAmount').value;
      
      if (!amount || parseFloat(amount) <= 0) {
        alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng ETH h·ª£p l·ªá');
        return;
      }
      
      if (!web3 || !userAccount) {
        alert('‚ö†Ô∏è Vui l√≤ng k·∫øt n·ªëi MetaMask tr∆∞·ªõc!');
        await connectWallet();
        return;
      }
      
      const currentBalance = parseFloat(document.getElementById('balanceSell').textContent);
      if (parseFloat(amount) > currentBalance) {
        alert(`‚ùå S·ªë d∆∞ kh√¥ng ƒë·ªß!\n\nS·ªë d∆∞ hi·ªán t·∫°i: ${currentBalance} ETH\nS·ªë l∆∞·ª£ng mu·ªën b√°n: ${amount} ETH`);
        return;
      }
      
      const price = parseFloat(document.getElementById('sellPrice').value) || 0;
      const total = (price * parseFloat(amount)).toFixed(2);
      
      if (confirm(`X√°c nh·∫≠n b√°n ${amount} ETH v·ªõi gi√° $${price.toLocaleString()}?\n\nT·ªïng: $${parseFloat(total).toLocaleString()} USDT`)) {
        try {
          // Save transaction to history
          const transaction = {
            type: 'withdraw',
            amount: amount,
            price: price,
            total: total,
            pair: document.querySelector('.market-item.active').dataset.pair,
            timestamp: Date.now(),
            txHash: 'Simulated-' + Date.now()
          };
          
          const history = JSON.parse(localStorage.getItem('transactionHistory') || '[]');
          history.push(transaction);
          localStorage.setItem('transactionHistory', JSON.stringify(history));
          
          // Reload histories
          loadOrderHistory();
          loadTradeHistory();
          
          // Update balance
          await updateBalance();
          
          alert(`‚úÖ ƒê√£ b√°n th√†nh c√¥ng ${amount} ETH!\n\nGiao d·ªãch ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o l·ªãch s·ª≠.`);
          
          // Clear inputs
          document.getElementById('sellAmount').value = '';
          document.getElementById('sellTotal').value = '';
          
        } catch (error) {
          console.error('Transaction error:', error);
          alert('‚ùå Giao d·ªãch th·∫•t b·∫°i\n\nL·ªói: ' + error.message);
        }
      }
    };

    // Add refresh balance button functionality
    const refreshBalanceBtn = document.createElement('button');
    refreshBalanceBtn.className = 'btn btn-sm btn-outline-info';
    refreshBalanceBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
    refreshBalanceBtn.title = 'L√†m m·ªõi s·ªë d∆∞';
    refreshBalanceBtn.onclick = async function() {
      if (web3 && userAccount) {
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        await updateBalance();
        this.innerHTML = '<i class="fas fa-sync-alt"></i>';
      } else {
        alert('‚ö†Ô∏è Vui l√≤ng k·∫øt n·ªëi MetaMask tr∆∞·ªõc!');
      }
    };
    
    // Add button to balance display
    const balanceContainer = document.getElementById('balance').parentElement;
    balanceContainer.parentElement.appendChild(refreshBalanceBtn);

    // Click wallet address to copy
    document.getElementById("walletAddress").addEventListener("click", function() {
      const fullAddress = localStorage.getItem("walletAddress");
      if (fullAddress) {
        navigator.clipboard.writeText(fullAddress).then(() => {
          const originalText = this.textContent;
          this.textContent = "‚úì ƒê√£ sao ch√©p";
          setTimeout(() => {
            const shortAddress = fullAddress.substring(0, 6) + '...' + fullAddress.substring(38);
            this.textContent = shortAddress;
          }, 2000);
        });
      }
    });

    // Add cursor pointer style
    document.getElementById("walletAddress").style.cursor = "pointer";

    // Initialize price chart with dark theme
    const ctx = document.getElementById('priceChart').getContext('2d');
    const priceChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
        datasets: [{
          label: 'ETH/USDT',
          data: [2298, 2315, 2289, 2334, 2356, 2341, 2345],
          borderColor: '#00ff41',
          backgroundColor: 'rgba(0, 255, 65, 0.1)',
          tension: 0.4,
          fill: true,
          pointBackgroundColor: '#00ff41',
          pointBorderColor: '#00ff41',
          pointHoverBackgroundColor: '#00cc33',
          pointHoverBorderColor: '#00ff41',
          pointRadius: 4,
          pointHoverRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: '#0d1117',
            borderColor: '#00ff41',
            borderWidth: 1,
            titleColor: '#00ff41',
            bodyColor: '#e0e0e0',
            padding: 12
          }
        },
        scales: {
          y: {
            beginAtZero: false,
            grid: {
              color: '#1e2139'
            },
            ticks: {
              color: '#8b949e'
            }
          },
          x: {
            grid: {
              color: '#1e2139'
            },
            ticks: {
              color: '#8b949e'
            }
          }
        }
      }
    });

    // Load real ETH price from CoinGecko API
    async function loadRealPrice() {
      try {
        const coins = 'ethereum,bitcoin,binancecoin,solana,ripple,cardano,dogecoin,matic-network,polkadot,avalanche-2,chainlink,uniswap,litecoin,cosmos,shiba-inu';
        const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coins}&vs_currencies=usd&include_24hr_change=true`);
        const data = await response.json();
        
        // Update ETH price (main display)
        const ethPrice = data.ethereum.usd;
        const ethChange = data.ethereum.usd_24h_change;
        document.getElementById('currentPrice').textContent = `$${ethPrice.toLocaleString()}`;
        document.getElementById('buyPrice').value = ethPrice.toFixed(2);
        document.getElementById('sellPrice').value = ethPrice.toFixed(2);
        
        // Update all market items
        document.querySelectorAll('.market-item').forEach(item => {
          const coinId = item.dataset.coin;
          if (data[coinId]) {
            const price = data[coinId].usd;
            const change = data[coinId].usd_24h_change;
            
            const priceElement = item.querySelector('.price-up, .price-down');
            const changeElement = item.querySelector('small');
            
            // Format price based on value
            let formattedPrice;
            if (price < 0.001) {
              formattedPrice = `$${price.toFixed(8)}`;
            } else if (price < 1) {
              formattedPrice = `$${price.toFixed(4)}`;
            } else if (price < 100) {
              formattedPrice = `$${price.toFixed(2)}`;
            } else {
              formattedPrice = `$${price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
            
            priceElement.textContent = formattedPrice;
            priceElement.className = change >= 0 ? 'price-up' : 'price-down';
            
            changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            changeElement.className = change >= 0 ? 'text-success' : 'text-danger';
          }
        });
        
        console.log('‚úÖ Prices updated from CoinGecko');
      } catch (error) {
        console.error('‚ùå Error loading prices:', error);
      }
    }

    function updateMarketItem(pair, price, change) {
      const item = document.querySelector(`[data-pair="${pair}"]`);
      if (!item) return;
      
      const priceElement = item.querySelector('.price-up, .price-down');
      const changeElement = item.querySelector('small');
      
      priceElement.textContent = `$${price.toLocaleString()}`;
      priceElement.className = change >= 0 ? 'price-up' : 'price-down';
      
      changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
      changeElement.className = change >= 0 ? 'text-success' : 'text-danger';
    }

    // Click market item to switch trading pair
    document.querySelectorAll('.market-item').forEach(item => {
      item.addEventListener('click', function() {
        // Remove active class from all items
        document.querySelectorAll('.market-item').forEach(i => i.classList.remove('active'));
        // Add active class to clicked item
        this.classList.add('active');
        
        // Update main display
        const pair = this.dataset.pair;
        const price = this.querySelector('.price-up, .price-down').textContent.replace(/[$,]/g, '');
        const change = this.querySelector('small').textContent;
        
        document.getElementById('currentPrice').textContent = `$${parseFloat(price).toLocaleString()}`;
        document.getElementById('buyPrice').value = parseFloat(price).toFixed(2);
        document.getElementById('sellPrice').value = parseFloat(price).toFixed(2);
        
        // Update chart title
        document.querySelector('.chart-header h5').textContent = pair;
        
        // Load chart for selected coin
        const coinId = this.dataset.coin;
        loadChartDataForCoin(coinId);
      });
    });

    // Load real chart data
    async function loadChartData() {
      await loadChartDataForCoin('ethereum');
    }

    async function loadChartDataForCoin(coinId) {
      try {
        const response = await fetch(`https://api.coingecko.com/api/v3/coins/${coinId}/market_chart?vs_currency=usd&days=1&interval=hourly`);
        const data = await response.json();
        
        // Update chart with real data
        const prices = data.prices.slice(-7); // Last 7 hours
        const labels = prices.map((p, i) => {
          const date = new Date(p[0]);
          return `${date.getHours()}:00`;
        });
        const values = prices.map(p => p[1]);
        
        priceChart.data.labels = labels;
        priceChart.data.datasets[0].data = values;
        priceChart.update();
        
        console.log(`‚úÖ Chart updated for ${coinId}`);
      } catch (error) {
        console.error('‚ùå Error loading chart data:', error);
      }
    }

    // Load initial data
    loadRealPrice();
    loadChartData();
    
    // Refresh prices every 30 seconds
    setInterval(loadRealPrice, 30000);
    
    // Refresh chart every 5 minutes
    setInterval(loadChartData, 300000);

    // Auto-calculate total
    document.getElementById('buyAmount').addEventListener('input', function() {
      const price = parseFloat(document.getElementById('buyPrice').value) || 0;
      const amount = parseFloat(this.value) || 0;
      document.getElementById('buyTotal').value = (price * amount).toFixed(2);
    });

    document.getElementById('sellAmount').addEventListener('input', function() {
      const price = parseFloat(document.getElementById('sellPrice').value) || 0;
      const amount = parseFloat(this.value) || 0;
      document.getElementById('sellTotal').value = (price * amount).toFixed(2);
    });

    // Load order history from localStorage
    function loadOrderHistory() {
      // Load from localStorage (saved by app.js)
      const history = JSON.parse(localStorage.getItem('transactionHistory') || '[]');
      const historyTable = document.querySelector('#orderHistory tbody');
      
      if (history.length === 0) {
        historyTable.innerHTML = '<tr><td colspan="8" class="text-center text-muted py-4">Ch∆∞a c√≥ l·ªãch s·ª≠ l·ªánh</td></tr>';
        return;
      }
      
      historyTable.innerHTML = history.slice(-20).reverse().map(tx => {
        const date = new Date(tx.timestamp);
        const time = date.toLocaleString('vi-VN');
        const isBuy = tx.type === 'deposit' || tx.type === 'N·∫°p';
        const side = isBuy ? 'Mua' : 'B√°n';
        const sideClass = isBuy ? 'text-success' : 'text-danger';
        const pair = tx.pair || 'ETH/USDT';
        
        return `
          <tr>
            <td>${time}</td>
            <td><strong>${pair}</strong></td>
            <td>Limit</td>
            <td class="${sideClass}">${side}</td>
            <td>$${parseFloat(tx.price || 0).toLocaleString()}</td>
            <td>${parseFloat(tx.amount || 0).toFixed(4)} ETH</td>
            <td>$${parseFloat(tx.total || 0).toLocaleString()}</td>
            <td><span class="badge bg-success">ƒê√£ kh·ªõp</span></td>
          </tr>
        `;
      }).join('');
    }

    // Load trade history
    function loadTradeHistory() {
      const history = JSON.parse(localStorage.getItem('transactionHistory') || '[]');
      const tradeTable = document.querySelector('#tradeHistory tbody');
      
      if (history.length === 0) {
        tradeTable.innerHTML = '<tr><td colspan="7" class="text-center text-muted py-4">Ch∆∞a c√≥ giao d·ªãch</td></tr>';
        return;
      }
      
      tradeTable.innerHTML = history.slice(-20).reverse().map(tx => {
        const date = new Date(tx.timestamp);
        const time = date.toLocaleString('vi-VN');
        const isBuy = tx.type === 'deposit' || tx.type === 'N·∫°p';
        const side = isBuy ? 'Mua' : 'B√°n';
        const sideClass = isBuy ? 'text-success' : 'text-danger';
        const pair = tx.pair || 'ETH/USDT';
        const amount = parseFloat(tx.amount || 0);
        const price = parseFloat(tx.price || 0);
        const total = parseFloat(tx.total || price * amount);
        const fee = total * 0.001; // 0.1% fee
        
        return `
          <tr>
            <td>${time}</td>
            <td><strong>${pair}</strong></td>
            <td class="${sideClass}">${side}</td>
            <td>$${price.toLocaleString()}</td>
            <td>${amount.toFixed(4)} ETH</td>
            <td>${fee.toFixed(2)} USDT</td>
            <td>$${total.toLocaleString()}</td>
          </tr>
        `;
      }).join('');
    }

    // Load open orders (simulated)
    function loadOpenOrders() {
      const openOrders = JSON.parse(localStorage.getItem('openOrders') || '[]');
      const openOrdersTable = document.querySelector('#openOrders tbody');
      
      if (openOrders.length === 0) {
        openOrdersTable.innerHTML = '<tr><td colspan="9" class="text-center text-muted py-4">Kh√¥ng c√≥ l·ªánh m·ªü</td></tr>';
        return;
      }
      
      openOrdersTable.innerHTML = openOrders.map((order, index) => {
        const date = new Date(order.timestamp);
        const time = date.toLocaleString('vi-VN');
        const isBuy = order.type === 'buy';
        const side = isBuy ? 'Mua' : 'B√°n';
        const sideClass = isBuy ? 'text-success' : 'text-danger';
        const filled = parseFloat(order.filled || 0);
        const amount = parseFloat(order.amount || 0);
        const filledPercent = ((filled / amount) * 100).toFixed(0);
        
        return `
          <tr>
            <td>${time}</td>
            <td><strong>${order.pair}</strong></td>
            <td>Limit</td>
            <td class="${sideClass}">${side}</td>
            <td>$${parseFloat(order.price).toLocaleString()}</td>
            <td>${amount.toFixed(4)} ETH</td>
            <td>${filled.toFixed(4)} (${filledPercent}%)</td>
            <td>$${(order.price * amount).toLocaleString()}</td>
            <td>
              <button class="btn btn-sm btn-danger" onclick="cancelOrder(${index})">
                <i class="fas fa-times"></i> H·ªßy
              </button>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Cancel order function
    window.cancelOrder = function(index) {
      const openOrders = JSON.parse(localStorage.getItem('openOrders') || '[]');
      const canceledOrder = openOrders[index];
      
      if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy l·ªánh ${canceledOrder.type === 'buy' ? 'MUA' : 'B√ÅN'} ${canceledOrder.amount} ETH?`)) {
        openOrders.splice(index, 1);
        localStorage.setItem('openOrders', JSON.stringify(openOrders));
        loadOpenOrders();
        alert('‚úÖ ƒê√£ h·ªßy l·ªánh th√†nh c√¥ng');
      }
    };

    // Load recent trades (simulated real-time)
    function loadRecentTrades() {
      const recentTradesTable = document.getElementById('recentTrades');
      const currentPrice = parseFloat(document.getElementById('currentPrice').textContent.replace(/[$,]/g, ''));
      
      // Generate random recent trades
      const trades = [];
      for (let i = 0; i < 15; i++) {
        const priceVariation = (Math.random() - 0.5) * 10;
        const price = currentPrice + priceVariation;
        const amount = (Math.random() * 2).toFixed(4);
        const isBuy = Math.random() > 0.5;
        const now = new Date();
        now.setSeconds(now.getSeconds() - i * 3);
        
        trades.push({
          price: price.toFixed(2),
          amount: amount,
          time: `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`,
          isBuy: isBuy
        });
      }
      
      recentTradesTable.innerHTML = trades.map(trade => `
        <tr>
          <td class="${trade.isBuy ? 'text-success' : 'text-danger'}">${parseFloat(trade.price).toLocaleString()}</td>
          <td class="text-end">${trade.amount}</td>
          <td class="text-end text-muted">${trade.time}</td>
        </tr>
      `).join('');
    }

    // Update order book with real-time data
    function updateOrderBook() {
      const currentPrice = parseFloat(document.getElementById('currentPrice').textContent.replace(/[$,]/g, ''));
      const sellOrdersTable = document.getElementById('sellOrders');
      const buyOrdersTable = document.getElementById('buyOrders');
      
      // Generate sell orders (above current price)
      const sellOrders = [];
      for (let i = 3; i >= 1; i--) {
        const price = currentPrice + (i * 2);
        const amount = (Math.random() * 5).toFixed(4);
        const total = (price * amount).toFixed(2);
        sellOrders.push({ price, amount, total });
      }
      
      sellOrdersTable.innerHTML = sellOrders.map(order => `
        <tr class="sell-order">
          <td class="text-danger">${order.price.toLocaleString()}</td>
          <td class="text-end">${order.amount}</td>
          <td class="text-end">${parseFloat(order.total).toLocaleString()}</td>
        </tr>
      `).join('');
      
      // Generate buy orders (below current price)
      const buyOrders = [];
      for (let i = 1; i <= 3; i++) {
        const price = currentPrice - (i * 2);
        const amount = (Math.random() * 5).toFixed(4);
        const total = (price * amount).toFixed(2);
        buyOrders.push({ price, amount, total });
      }
      
      buyOrdersTable.innerHTML = buyOrders.map(order => `
        <tr class="buy-order">
          <td class="text-success">${order.price.toLocaleString()}</td>
          <td class="text-end">${order.amount}</td>
          <td class="text-end">${parseFloat(order.total).toLocaleString()}</td>
        </tr>
      `).join('');
      
      // Update current price in order book
      document.querySelector('.current-price-row strong').textContent = currentPrice.toLocaleString();
      document.querySelector('.current-price-row small').textContent = `‚âà $${currentPrice.toLocaleString()}`;
    }

    // Load all history on page load
    loadOrderHistory();
    loadTradeHistory();
    loadOpenOrders();
    loadRecentTrades();
    
    // Refresh recent trades and order book every 3 seconds
    setInterval(() => {
      loadRecentTrades();
      updateOrderBook();
    }, 3000);
    
    // Refresh history when tab is switched
    document.querySelectorAll('a[data-bs-toggle="tab"]').forEach(tab => {
      tab.addEventListener('shown.bs.tab', function (e) {
        if (e.target.getAttribute('href') === '#orderHistory') {
          loadOrderHistory();
        } else if (e.target.getAttribute('href') === '#tradeHistory') {
          loadTradeHistory();
        } else if (e.target.getAttribute('href') === '#openOrders') {
          loadOpenOrders();
        }
      });
    });
  </script>
</body>
</html>
